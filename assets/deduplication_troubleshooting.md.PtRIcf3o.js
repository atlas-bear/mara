import{_ as t,c as i,o,ag as a}from"./chunks/framework.BONmpqY0.js";const g=JSON.parse('{"title":"Deduplication System Troubleshooting Guide","description":"","frontmatter":{},"headers":[],"relativePath":"deduplication/troubleshooting.md","filePath":"deduplication/troubleshooting.md"}'),n={name:"deduplication/troubleshooting.md"};function s(r,e,l,d,c,u){return o(),i("div",null,e[0]||(e[0]=[a(`<h1 id="deduplication-system-troubleshooting-guide" tabindex="-1">Deduplication System Troubleshooting Guide <a class="header-anchor" href="#deduplication-system-troubleshooting-guide" aria-label="Permalink to &quot;Deduplication System Troubleshooting Guide&quot;">​</a></h1><p>This guide provides information for diagnosing and resolving issues with the cross-source deduplication system.</p><h2 id="common-issues-and-solutions" tabindex="-1">Common Issues and Solutions <a class="header-anchor" href="#common-issues-and-solutions" aria-label="Permalink to &quot;Common Issues and Solutions&quot;">​</a></h2><h3 id="no-matches-being-found" tabindex="-1">No Matches Being Found <a class="header-anchor" href="#no-matches-being-found" aria-label="Permalink to &quot;No Matches Being Found&quot;">​</a></h3><p>If the deduplication system isn&#39;t finding matches that you expect it to identify:</p><ol><li><strong>Check the logs</strong>: Look for <code>&quot;Found X potential matches&quot;</code> with <code>highConfidence</code> and <code>mediumConfidence</code> counts</li><li><strong>Review similarity scores</strong>: Examine the detailed component scores to see where potential matches are falling short</li><li><strong>Test with lower threshold</strong>: Run the function with a lower confidence threshold (e.g., <code>?confidenceThreshold=0.6</code>)</li><li><strong>Check data consistency</strong>: Ensure time and location data is correctly formatted in raw_data records</li><li><strong>Examine match criteria</strong>: Check the logs for &quot;Match case&quot; info messages to see which match criteria are being evaluated</li></ol><h3 id="incorrect-matches" tabindex="-1">Incorrect Matches <a class="header-anchor" href="#incorrect-matches" aria-label="Permalink to &quot;Incorrect Matches&quot;">​</a></h3><p>If the system is incorrectly matching records that aren&#39;t related:</p><ol><li><strong>Increase confidence threshold</strong>: Raise the threshold to require more evidence (e.g., <code>?confidenceThreshold=0.8</code>)</li><li><strong>Examine similarity components</strong>: Review the logs to see which factors are driving the high similarity score</li><li><strong>Adjust weights</strong>: Consider updating the weight distribution in <code>calculateSimilarityScore</code></li></ol><h3 id="records-being-re-merged-incorrectly" tabindex="-1">Records Being Re-merged Incorrectly <a class="header-anchor" href="#records-being-re-merged-incorrectly" aria-label="Permalink to &quot;Records Being Re-merged Incorrectly&quot;">​</a></h3><p>If records that were already merged are being incorrectly re-merged with different records:</p><ol><li><strong>Check merge chains</strong>: Verify that the system is properly tracking merge relationships with the logs showing &quot;Following merge chain&quot; messages</li><li><strong>Validate merge status fields</strong>: Ensure records have the correct <code>merge_status</code> and <code>merged_into</code> fields set</li><li><strong>Look for timing issues</strong>: Check if the incident processing is happening before deduplication has completed</li></ol><h3 id="incident-links-being-lost" tabindex="-1">Incident Links Being Lost <a class="header-anchor" href="#incident-links-being-lost" aria-label="Permalink to &quot;Incident Links Being Lost&quot;">​</a></h3><p>If incident links are not being preserved during merges:</p><ol><li><strong>Check the logs</strong>: Look for messages like &quot;Preserved incident link from primary record&quot; or &quot;Transferred incident link from secondary record&quot;</li><li><strong>Verify incident link fields</strong>: Ensure the <code>linked_incident</code> and <code>has_incident</code> fields are being properly maintained</li><li><strong>Check for incidents linked to different incidents</strong>: Look for warning logs showing &quot;Records linked to DIFFERENT incidents&quot;</li></ol><h3 id="process-raw-data-not-running-after-deduplication" tabindex="-1">Process-raw-data Not Running After Deduplication <a class="header-anchor" href="#process-raw-data-not-running-after-deduplication" aria-label="Permalink to &quot;Process-raw-data Not Running After Deduplication&quot;">​</a></h3><p>If the incident processing isn&#39;t being triggered after deduplication:</p><ol><li><strong>Check PUBLIC_URL</strong>: Ensure the <code>PUBLIC_URL</code> environment variable is set correctly in Netlify</li><li><strong>Review error logs</strong>: Look for errors related to triggering the process function</li><li><strong>Test the process function</strong>: Try manually triggering the process function to ensure it works</li><li><strong>Verify network access</strong>: Ensure the function has network access to make the POST request</li></ol><h3 id="missing-required-fields" tabindex="-1">Missing Required Fields <a class="header-anchor" href="#missing-required-fields" aria-label="Permalink to &quot;Missing Required Fields&quot;">​</a></h3><p>If deduplication fails due to missing fields:</p><ol><li><strong>Check for required fields</strong>: Ensure raw_data records have date, latitude, and longitude fields</li><li><strong>Validate coordinates</strong>: Make sure latitude and longitude values are valid numbers</li><li><strong>Add data validation</strong>: Consider enhancing the system to better validate and normalize input data</li></ol><h2 id="interpreting-logs" tabindex="-1">Interpreting Logs <a class="header-anchor" href="#interpreting-logs" aria-label="Permalink to &quot;Interpreting Logs&quot;">​</a></h2><p>The deduplication system produces detailed logs for troubleshooting. Here&#39;s how to interpret key log entries:</p><h3 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INFO {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Configuration&quot;,&quot;dryRun&quot;:false,&quot;confidenceThreshold&quot;:0.7,&quot;maxRecords&quot;:100}</span></span></code></pre></div><p>Confirms the runtime configuration, including:</p><ul><li><code>dryRun</code>: Whether changes are being applied or just simulated</li><li><code>confidenceThreshold</code>: The similarity score required for merging</li><li><code>maxRecords</code>: Maximum number of records processed</li></ul><h3 id="record-fetching" tabindex="-1">Record Fetching <a class="header-anchor" href="#record-fetching" aria-label="Permalink to &quot;Record Fetching&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INFO {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Retrieved 30 records for processing&quot;}</span></span>
<span class="line"><span>INFO {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Found 4 different sources&quot;,&quot;sources&quot;:[&quot;ICC&quot;,&quot;RECAAP&quot;,&quot;MDAT&quot;,&quot;UKMTO&quot;]}</span></span></code></pre></div><p>Shows the number of records retrieved and the distribution across sources.</p><h3 id="similarity-scoring" tabindex="-1">Similarity Scoring <a class="header-anchor" href="#similarity-scoring" aria-label="Permalink to &quot;Similarity Scoring&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INFO {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Similarity score components&quot;,&quot;recordIds&quot;:[&quot;recA&quot;,&quot;recB&quot;],&quot;timeScore&quot;:0.95,&quot;spatialScore&quot;:0.98,&quot;vesselNameScore&quot;:0,&quot;vesselIMOScore&quot;:0,&quot;incidentTypeScore&quot;:0.8}</span></span></code></pre></div><p>Provides detailed breakdown of similarity calculation between two records:</p><ul><li><code>timeScore</code>: Time proximity (higher = closer in time)</li><li><code>spatialScore</code>: Spatial proximity (higher = closer in location)</li><li><code>vesselNameScore</code>: Vessel name similarity</li><li><code>vesselIMOScore</code>: IMO number match (0 or 1)</li><li><code>incidentTypeScore</code>: Incident type similarity</li></ul><h3 id="match-results" tabindex="-1">Match Results <a class="header-anchor" href="#match-results" aria-label="Permalink to &quot;Match Results&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INFO {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Found 12 potential matches&quot;,&quot;highConfidence&quot;:3,&quot;mediumConfidence&quot;:9,&quot;analyzedPairs&quot;:120}</span></span></code></pre></div><p>Summarizes the match analysis:</p><ul><li><code>highConfidence</code>: Matches above the high confidence threshold (≥0.8)</li><li><code>mediumConfidence</code>: Matches in the medium confidence range (0.6-0.8)</li><li><code>analyzedPairs</code>: Total number of record pairs compared</li></ul><h3 id="primary-record-determination" tabindex="-1">Primary Record Determination <a class="header-anchor" href="#primary-record-determination" aria-label="Permalink to &quot;Primary Record Determination&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INFO {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Primary record determination&quot;,&quot;record1&quot;:{...},&quot;record2&quot;:{...}}</span></span></code></pre></div><p>Shows the scoring used to determine which record becomes primary in a merge operation.</p><h3 id="processing-results" tabindex="-1">Processing Results <a class="header-anchor" href="#processing-results" aria-label="Permalink to &quot;Processing Results&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>INFO {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Successfully merged records&quot;,&quot;primaryId&quot;:&quot;recA&quot;,&quot;secondaryId&quot;:&quot;recB&quot;}</span></span>
<span class="line"><span>INFO {&quot;level&quot;:&quot;info&quot;,&quot;msg&quot;:&quot;Cross-Source Deduplication complete&quot;,&quot;recordsAnalyzed&quot;:30,&quot;mergesPerformed&quot;:3}</span></span></code></pre></div><p>Confirms successful merges and provides a summary of the processing run.</p><h2 id="testing-the-deduplication-system" tabindex="-1">Testing the Deduplication System <a class="header-anchor" href="#testing-the-deduplication-system" aria-label="Permalink to &quot;Testing the Deduplication System&quot;">​</a></h2><h3 id="using-dry-run-mode" tabindex="-1">Using Dry Run Mode <a class="header-anchor" href="#using-dry-run-mode" aria-label="Permalink to &quot;Using Dry Run Mode&quot;">​</a></h3><p>To test the system without making changes:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>curl -X POST &quot;https://your-netlify-site.netlify.app/.netlify/functions/deduplicate-cross-source-background?dryRun=true&quot;</span></span></code></pre></div><p>This will identify potential matches but won&#39;t update any records, allowing you to review the results before making changes.</p><h3 id="testing-with-sample-data" tabindex="-1">Testing with Sample Data <a class="header-anchor" href="#testing-with-sample-data" aria-label="Permalink to &quot;Testing with Sample Data&quot;">​</a></h3><ol><li><p>Create test records in Airtable with controlled variations:</p><ul><li>Same incident reported by different sources</li><li>Similar incidents with different vessels</li><li>Unrelated incidents with geographical proximity</li></ul></li><li><p>Run the deduplication with these test cases and review the logs to see how the system interprets them.</p></li></ol><h3 id="testing-different-thresholds" tabindex="-1">Testing Different Thresholds <a class="header-anchor" href="#testing-different-thresholds" aria-label="Permalink to &quot;Testing Different Thresholds&quot;">​</a></h3><p>Test the sensitivity of the system by varying the confidence threshold:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>curl -X POST &quot;https://your-netlify-site.netlify.app/.netlify/functions/deduplicate-cross-source-background?confidenceThreshold=0.65&quot;</span></span></code></pre></div><p>Try different thresholds (0.6, 0.7, 0.8) and analyze how the match results change.</p><h2 id="monitoring-and-maintenance" tabindex="-1">Monitoring and Maintenance <a class="header-anchor" href="#monitoring-and-maintenance" aria-label="Permalink to &quot;Monitoring and Maintenance&quot;">​</a></h2><h3 id="regular-log-review" tabindex="-1">Regular Log Review <a class="header-anchor" href="#regular-log-review" aria-label="Permalink to &quot;Regular Log Review&quot;">​</a></h3><ul><li>Check logs after each deduplication run to monitor performance</li><li>Look for patterns in matching/non-matching records</li><li>Track the number of merges performed over time</li></ul><h3 id="system-tuning" tabindex="-1">System Tuning <a class="header-anchor" href="#system-tuning" aria-label="Permalink to &quot;System Tuning&quot;">​</a></h3><p>Based on observed performance:</p><ol><li>Adjust confidence thresholds if needed</li><li>Update similarity calculation weights</li><li>Modify source priorities based on data quality</li></ol><h3 id="data-quality-improvements" tabindex="-1">Data Quality Improvements <a class="header-anchor" href="#data-quality-improvements" aria-label="Permalink to &quot;Data Quality Improvements&quot;">​</a></h3><ul><li>Address any systematic data issues identified during deduplication</li><li>Standardize date/time formats across sources</li><li>Implement coordinate normalization if needed</li><li>Work with data providers to improve data consistency</li></ul>`,63)]))}const p=t(n,[["render",s]]);export{g as __pageData,p as default};
