<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Data Pipeline Troubleshooting Guide | MARA Documentation</title>
    <meta name="description" content="Documentation for the Maritime Risk Analysis system">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/mara/assets/style.B9amjzLO.css" as="style">
    <link rel="preload stylesheet" href="/mara/vp-icons.css" as="style">
    
    <script type="module" src="/mara/assets/app.DyBrfPQ7.js"></script>
    <link rel="preload" href="/mara/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/mara/assets/chunks/theme.JX4UXoWB.js">
    <link rel="modulepreload" href="/mara/assets/chunks/framework.BONmpqY0.js">
    <link rel="modulepreload" href="/mara/assets/data-pipeline_troubleshooting.md.CtiwH0un.lean.js">
    <link rel="icon" href="https://drive.google.com/uc?id=1OB5Lwgpp03DB9vs50T_kkKzL5VV_y5Eo" type="image/png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle has-sidebar" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/mara/" data-v-9f43907a><!--[--><!--]--><!--[--><img class="VPImage logo" src="https://drive.google.com/uc?id=1OB5Lwgpp03DB9vs50T_kkKzL5VV_y5Eo" alt data-v-ab19afbb><!--]--><span data-v-9f43907a>MARA Documentation</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mara/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mara/guide/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mara/components/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Components</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mara/data-pipeline/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Data Pipeline</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mara/deduplication/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Deduplication</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mara/ai-integration/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>AI Integration</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mara/flash-report/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Flash Reports</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mara/weekly-report/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Weekly Reports</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/mara/api/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>API</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/atlas-bear/mara" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/atlas-bear/mara" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2488c25a><span class="vpi-align-left menu-icon" data-v-2488c25a></span><span class="menu-text" data-v-2488c25a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d8b57b2d data-v-42c4c606><div class="curtain" data-v-42c4c606></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-42c4c606><span class="visually-hidden" id="sidebar-aria-label" data-v-42c4c606> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 has-active" data-v-51288d80 data-v-0009425e><div class="item" role="button" tabindex="0" data-v-0009425e><div class="indicator" data-v-0009425e></div><h2 class="text" data-v-0009425e>Data Pipeline</h2><!----></div><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/mara/data-pipeline/" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/mara/data-pipeline/data-collection.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Data Collection</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/mara/data-pipeline/data-processing.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Data Processing</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/mara/data-pipeline/troubleshooting.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Troubleshooting</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-sidebar has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _mara_data-pipeline_troubleshooting" data-v-e6f2a212><div><h1 id="data-pipeline-troubleshooting-guide" tabindex="-1">Data Pipeline Troubleshooting Guide <a class="header-anchor" href="#data-pipeline-troubleshooting-guide" aria-label="Permalink to &quot;Data Pipeline Troubleshooting Guide&quot;">​</a></h1><p>This guide provides solutions for common issues encountered with the MARA data pipeline and instructions for monitoring and maintaining the system.</p><h2 id="common-issues-and-solutions" tabindex="-1">Common Issues and Solutions <a class="header-anchor" href="#common-issues-and-solutions" aria-label="Permalink to &quot;Common Issues and Solutions&quot;">​</a></h2><h3 id="collection-issues" tabindex="-1">Collection Issues <a class="header-anchor" href="#collection-issues" aria-label="Permalink to &quot;Collection Issues&quot;">​</a></h3><h4 id="no-data-being-collected-from-a-source" tabindex="-1">No Data Being Collected from a Source <a class="header-anchor" href="#no-data-being-collected-from-a-source" aria-label="Permalink to &quot;No Data Being Collected from a Source&quot;">​</a></h4><p>If a specific collection function is not gathering any data:</p><ol><li><strong>Check Source Availability</strong>: Verify that the source&#39;s API or website is operational</li><li><strong>Examine Function Logs</strong>: Look for connection errors or authentication issues</li><li><strong>Verify API Credentials</strong>: Ensure API keys are valid and properly set in environment variables</li><li><strong>Check Rate Limiting</strong>: Determine if the source has imposed rate limits</li><li><strong>Test Manual Collection</strong>: Attempt a manual trigger of the collection function</li></ol><h4 id="duplicate-raw-data-entries" tabindex="-1">Duplicate Raw Data Entries <a class="header-anchor" href="#duplicate-raw-data-entries" aria-label="Permalink to &quot;Duplicate Raw Data Entries&quot;">​</a></h4><p>If you notice duplicate entries in the <code>raw_data</code> table:</p><ol><li><strong>Check Source Reference IDs</strong>: Ensure the source is providing unique reference IDs</li><li><strong>Review Deduplication Logic</strong>: Verify the source-specific deduplication logic</li><li><strong>Examine Hash Generation</strong>: Ensure content hashing is correctly implemented</li><li><strong>Check for API Changes</strong>: Source API changes may affect how references are generated</li><li><strong>Clear Hash Cache</strong>: Use the <code>clear-all-hashes.js</code> function to reset hash caching</li></ol><h3 id="processing-issues" tabindex="-1">Processing Issues <a class="header-anchor" href="#processing-issues" aria-label="Permalink to &quot;Processing Issues&quot;">​</a></h3><h4 id="raw-data-not-being-processed" tabindex="-1">Raw Data Not Being Processed <a class="header-anchor" href="#raw-data-not-being-processed" aria-label="Permalink to &quot;Raw Data Not Being Processed&quot;">​</a></h4><p>If raw data is being collected but not processed into incidents:</p><ol><li><strong>Check Processing Status</strong>: Verify that records don&#39;t have the <code>processing_status</code> set to &quot;Processing&quot; (stuck records)</li><li><strong>Review Filter Formula</strong>: Ensure the selection formula in <code>process-raw-data-background.js</code> is working correctly</li><li><strong>Examine Function Logs</strong>: Look for errors during processing</li><li><strong>Verify Claude API Key</strong>: Ensure the Claude API key is valid for LLM enrichment</li><li><strong>Check Environment Variables</strong>: Verify all required environment variables are set</li></ol><h4 id="poor-quality-incident-analysis" tabindex="-1">Poor Quality Incident Analysis <a class="header-anchor" href="#poor-quality-incident-analysis" aria-label="Permalink to &quot;Poor Quality Incident Analysis&quot;">​</a></h4><p>If the AI-generated analysis is low quality:</p><ol><li><strong>Review Claude Prompts</strong>: Check and refine the prompts in <code>process-raw-data-background.js</code></li><li><strong>Examine Raw Data Quality</strong>: Poor input data can lead to poor analysis</li><li><strong>Verify Claude Model</strong>: Ensure the function is using the correct Claude model version</li><li><strong>Check Token Limits</strong>: Ensure prompts and responses are within token limits</li><li><strong>Sample Analysis</strong>: Review logs to see what Claude is generating</li></ol><h4 id="missing-vessel-information" tabindex="-1">Missing Vessel Information <a class="header-anchor" href="#missing-vessel-information" aria-label="Permalink to &quot;Missing Vessel Information&quot;">​</a></h4><p>If vessel data is not being properly linked to incidents:</p><ol><li><strong>Check Raw Data</strong>: Verify that source data includes vessel information</li><li><strong>Review Vessel Join Logic</strong>: Examine the vessel linking code</li><li><strong>Check Vessel Lookup</strong>: Ensure vessel lookup by name and IMO is working</li><li><strong>Examine Vessel Creation</strong>: Verify new vessels are being created properly</li><li><strong>Reconcile Vessel Names</strong>: Check for inconsistent vessel naming across sources</li></ol><h3 id="deduplication-issues" tabindex="-1">Deduplication Issues <a class="header-anchor" href="#deduplication-issues" aria-label="Permalink to &quot;Deduplication Issues&quot;">​</a></h3><h4 id="missed-duplicate-incidents" tabindex="-1">Missed Duplicate Incidents <a class="header-anchor" href="#missed-duplicate-incidents" aria-label="Permalink to &quot;Missed Duplicate Incidents&quot;">​</a></h4><p>If the system fails to identify duplicates:</p><ol><li><strong>Review Confidence Threshold</strong>: Adjust the similarity threshold in the deduplication function</li><li><strong>Check Time Window</strong>: Ensure the time window is appropriate (default: 48 hours)</li><li><strong>Examine Distance Calculation</strong>: Verify spatial proximity calculation</li><li><strong>Review Vessel Matching</strong>: Check vessel name and IMO matching logic</li><li><strong>Update Weights</strong>: Adjust the weights in the similarity score calculation</li></ol><h4 id="incorrect-merging" tabindex="-1">Incorrect Merging <a class="header-anchor" href="#incorrect-merging" aria-label="Permalink to &quot;Incorrect Merging&quot;">​</a></h4><p>If unrelated incidents are incorrectly merged:</p><ol><li><strong>Increase Confidence Threshold</strong>: Raise the threshold for required similarity</li><li><strong>Examine Similarity Components</strong>: Determine which factors are causing high similarity</li><li><strong>Add Additional Constraints</strong>: Implement additional rules for deduplication</li><li><strong>Use Dry Run Mode</strong>: Test changes with the dry run mode before applying</li></ol><p>For detailed deduplication troubleshooting, see the <a href="./../deduplication/troubleshooting.html">Deduplication Troubleshooting Guide</a>.</p><h2 id="monitoring-the-pipeline" tabindex="-1">Monitoring the Pipeline <a class="header-anchor" href="#monitoring-the-pipeline" aria-label="Permalink to &quot;Monitoring the Pipeline&quot;">​</a></h2><h3 id="key-logs-to-monitor" tabindex="-1">Key Logs to Monitor <a class="header-anchor" href="#key-logs-to-monitor" aria-label="Permalink to &quot;Key Logs to Monitor&quot;">​</a></h3><p>The MARA data pipeline produces several important log patterns to monitor:</p><ol><li><p><strong>Collection Success Indicators</strong>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Successfully collected X incidents from SOURCE</span></span></code></pre></div></li><li><p><strong>Deduplication Activity</strong>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Found X potential matches&quot;,&quot;highConfidence&quot;:Y,&quot;mediumConfidence&quot;:Z,&quot;analyzedPairs&quot;:W</span></span></code></pre></div></li><li><p><strong>Processing Progress</strong>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Found record to process: {id: X, title: Y}</span></span></code></pre></div></li><li><p><strong>LLM Integration Status</strong>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Successfully processed Claude response with generated title</span></span></code></pre></div></li></ol><h3 id="health-check-functions" tabindex="-1">Health Check Functions <a class="header-anchor" href="#health-check-functions" aria-label="Permalink to &quot;Health Check Functions&quot;">​</a></h3><p>Several utility functions can be used to check system health:</p><ol><li><strong><code>check-env.js</code></strong>: Verifies that required environment variables are set</li><li><strong><code>monitor-runs.js</code></strong>: Shows recent collection and processing runs</li><li><strong><code>check-cache.js</code></strong>: Verifies that caching is operational</li></ol><h3 id="manual-triggers" tabindex="-1">Manual Triggers <a class="header-anchor" href="#manual-triggers" aria-label="Permalink to &quot;Manual Triggers&quot;">​</a></h3><p>For manual testing or intervention, you can trigger pipeline stages directly:</p><ol><li><p><strong>Collection</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://your-netlify-site.netlify.app/.netlify/functions/collect-recaap&quot;</span></span></code></pre></div></li><li><p><strong>Deduplication</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://your-netlify-site.netlify.app/.netlify/functions/deduplicate-cross-source-background?dryRun=true&quot;</span></span></code></pre></div></li><li><p><strong>Processing</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://your-netlify-site.netlify.app/.netlify/functions/process-raw-data-background&quot;</span></span></code></pre></div></li></ol><h3 id="key-metrics-to-track" tabindex="-1">Key Metrics to Track <a class="header-anchor" href="#key-metrics-to-track" aria-label="Permalink to &quot;Key Metrics to Track&quot;">​</a></h3><p>Monitor these metrics to ensure pipeline health:</p><ol><li><strong>Collection Success Rate</strong>: Percentage of successful source collection runs</li><li><strong>Deduplication Accuracy</strong>: Number of correct merges vs. incorrect merges</li><li><strong>Processing Completion Time</strong>: Average time to process a raw data record</li><li><strong>LLM Enrichment Success</strong>: Percentage of records successfully enriched with AI</li><li><strong>Pipeline Throughput</strong>: Number of incidents processed per hour</li></ol><h2 id="performance-tuning" tabindex="-1">Performance Tuning <a class="header-anchor" href="#performance-tuning" aria-label="Permalink to &quot;Performance Tuning&quot;">​</a></h2><h3 id="collection-optimization" tabindex="-1">Collection Optimization <a class="header-anchor" href="#collection-optimization" aria-label="Permalink to &quot;Collection Optimization&quot;">​</a></h3><p>To optimize collection performance:</p><ol><li><strong>Adjust Collection Frequency</strong>: Modify the schedule in <code>netlify.toml</code> to match source update patterns</li><li><strong>Implement Incremental Collection</strong>: Only fetch new records since last successful run</li><li><strong>Optimize API Requests</strong>: Use filtering and field selection to reduce data transferred</li><li><strong>Implement Caching</strong>: Cache API responses where appropriate</li><li><strong>Use Batch Processing</strong>: Process records in batches rather than individually</li></ol><h3 id="processing-optimization" tabindex="-1">Processing Optimization <a class="header-anchor" href="#processing-optimization" aria-label="Permalink to &quot;Processing Optimization&quot;">​</a></h3><p>To optimize incident processing:</p><ol><li><strong>Adjust Batch Size</strong>: Modify the number of records processed in each function invocation</li><li><strong>Optimize LLM Prompts</strong>: Refine prompts to reduce token usage</li><li><strong>Implement Parallel Processing</strong>: Process multiple records simultaneously</li><li><strong>Cache Reference Data</strong>: Reduce database lookups for common reference items</li><li><strong>Optimize Database Queries</strong>: Minimize Airtable API calls with batched operations</li></ol><h2 id="recovery-procedures" tabindex="-1">Recovery Procedures <a class="header-anchor" href="#recovery-procedures" aria-label="Permalink to &quot;Recovery Procedures&quot;">​</a></h2><h3 id="handling-stuck-records" tabindex="-1">Handling Stuck Records <a class="header-anchor" href="#handling-stuck-records" aria-label="Permalink to &quot;Handling Stuck Records&quot;">​</a></h3><p>If records get stuck in &quot;Processing&quot; status:</p><ol><li><p>Run this Airtable formula to identify stuck records:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>AND({processing_status} = &#39;Processing&#39;, IS_BEFORE({last_processed}, DATEADD(NOW(), -1, &#39;hours&#39;)))</span></span></code></pre></div></li><li><p>Update stuck records to reset their status:</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fields</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  processing_status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pending&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  processing_notes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`Reset from stuck state at ${</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toISOString</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li></ol><h3 id="recovering-from-failed-runs" tabindex="-1">Recovering from Failed Runs <a class="header-anchor" href="#recovering-from-failed-runs" aria-label="Permalink to &quot;Recovering from Failed Runs&quot;">​</a></h3><p>If a pipeline stage fails completely:</p><ol><li><strong>Check Environment Variables</strong>: Verify all required variables are set</li><li><strong>Review Function Logs</strong>: Identify the root cause of the failure</li><li><strong>Fix Underlying Issues</strong>: Address any API, permission, or code issues</li><li><strong>Reset Processing Status</strong>: Update any affected records</li><li><strong>Trigger Manual Run</strong>: Manually trigger the failed pipeline stage</li></ol><h3 id="data-correction" tabindex="-1">Data Correction <a class="header-anchor" href="#data-correction" aria-label="Permalink to &quot;Data Correction&quot;">​</a></h3><p>If incorrect data has been processed:</p><ol><li><strong>Identify Affected Records</strong>: Use Airtable views to isolate problematic records</li><li><strong>Correct Raw Data</strong>: Fix issues in the raw data if necessary</li><li><strong>Update Processing Status</strong>: Set processing_status to &quot;pending&quot; to reprocess</li><li><strong>Clear Cached Data</strong>: Clear any cached versions of the records</li><li><strong>Trigger Reprocessing</strong>: Manually trigger the processing function</li></ol></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/mara/data-pipeline/data-processing.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Previous page</span><span class="title" data-v-1bcd8184>Data Processing</span><!--]--></a></div><div class="pager" data-v-1bcd8184><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-d8b57b2d data-v-566314d4><div class="container" data-v-566314d4><p class="message" data-v-566314d4>Released under the Internal License.</p><p class="copyright" data-v-566314d4>Copyright © 2023-present Atlas Bear</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"ai-integration_index.md\":\"BWIGsJbD\",\"ai-integration_prompts-system.md\":\"vAOKjWg4\",\"api_authentication.md\":\"CGk9SOU3\",\"api_endpoints_incidents.md\":\"CkibLASL\",\"api_error-codes.md\":\"DsNPeTXt\",\"api_index.md\":\"sAuSpiKG\",\"api_rate-limits.md\":\"B4wBgKsp\",\"components_index.md\":\"z6P4EwWW\",\"components_maritime-map.md\":\"DsDdmsAy\",\"components_pdf-download-button.md\":\"CcC59VUh\",\"components_static-map.md\":\"CDnaQayq\",\"data-pipeline_data-collection.md\":\"CbZdQQLF\",\"data-pipeline_data-processing.md\":\"CAqa2APE\",\"data-pipeline_index.md\":\"BOniQ1fr\",\"data-pipeline_troubleshooting.md\":\"CtiwH0un\",\"deduplication_implementation.md\":\"BAAmcQsL\",\"deduplication_index.md\":\"C7zfcAZp\",\"deduplication_troubleshooting.md\":\"PtRIcf3o\",\"flash-report_api-reference.md\":\"DX7nNuEi\",\"flash-report_architecture.md\":\"D9pKX3Bx\",\"flash-report_automation-system.md\":\"BLSa-nBa\",\"flash-report_cache-implementation.md\":\"tfbQ2NDL\",\"flash-report_index.md\":\"C6kP9rww\",\"flash-report_integration-guide.md\":\"GYTWCc7u\",\"flash-report_overview.md\":\"CN0N7mJh\",\"flash-report_testing-guide.md\":\"CBB-LXAO\",\"guide_architecture.md\":\"B80Pkxob\",\"guide_deployment.md\":\"DaPtdKUc\",\"guide_getting-started.md\":\"D-L5WWZw\",\"guide_index.md\":\"DvzUFPSs\",\"guide_installation.md\":\"Cntmt2Id\",\"index.md\":\"bvp_W4hb\",\"migration-plan.md\":\"BhyYEMxd\",\"readme.md\":\"CDH59HGp\",\"weekly-report_api-reference.md\":\"BTIZ2Xio\",\"weekly-report_data-flow.md\":\"B5S51BWm\",\"weekly-report_date-handling.md\":\"CRq9457T\",\"weekly-report_email-notifications.md\":\"D3hw4C-v\",\"weekly-report_implementation.md\":\"DOWV4f3h\",\"weekly-report_index.md\":\"Ir_PtMFG\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"MARA Documentation\",\"description\":\"Documentation for the Maritime Risk Analysis system\",\"base\":\"/mara/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"https://drive.google.com/uc?id=1OB5Lwgpp03DB9vs50T_kkKzL5VV_y5Eo\",\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Guide\",\"link\":\"/guide/\"},{\"text\":\"Components\",\"link\":\"/components/\"},{\"text\":\"Data Pipeline\",\"link\":\"/data-pipeline/\"},{\"text\":\"Deduplication\",\"link\":\"/deduplication/\"},{\"text\":\"AI Integration\",\"link\":\"/ai-integration/\"},{\"text\":\"Flash Reports\",\"link\":\"/flash-report/\"},{\"text\":\"Weekly Reports\",\"link\":\"/weekly-report/\"},{\"text\":\"API\",\"link\":\"/api/\"}],\"sidebar\":{\"/guide/\":[{\"text\":\"Introduction\",\"items\":[{\"text\":\"Getting Started\",\"link\":\"/guide/getting-started\"},{\"text\":\"Architecture\",\"link\":\"/guide/architecture\"},{\"text\":\"Installation\",\"link\":\"/guide/installation\"},{\"text\":\"Deployment\",\"link\":\"/guide/deployment\"}]}],\"/components/\":[{\"text\":\"UI Components\",\"items\":[{\"text\":\"Overview\",\"link\":\"/components/\"},{\"text\":\"PDF Download Button\",\"link\":\"/components/pdf-download-button\"},{\"text\":\"Maritime Map\",\"link\":\"/components/maritime-map\"}]}],\"/data-pipeline/\":[{\"text\":\"Data Pipeline\",\"items\":[{\"text\":\"Overview\",\"link\":\"/data-pipeline/\"},{\"text\":\"Data Collection\",\"link\":\"/data-pipeline/data-collection\"},{\"text\":\"Data Processing\",\"link\":\"/data-pipeline/data-processing\"},{\"text\":\"Troubleshooting\",\"link\":\"/data-pipeline/troubleshooting\"}]}],\"/deduplication/\":[{\"text\":\"Cross-Source Deduplication\",\"items\":[{\"text\":\"Overview\",\"link\":\"/deduplication/\"},{\"text\":\"Implementation\",\"link\":\"/deduplication/implementation\"},{\"text\":\"Troubleshooting\",\"link\":\"/deduplication/troubleshooting\"}]}],\"/flash-report/\":[{\"text\":\"Flash Reports\",\"items\":[{\"text\":\"Overview\",\"link\":\"/flash-report/\"},{\"text\":\"API Reference\",\"link\":\"/flash-report/api-reference\"},{\"text\":\"Architecture\",\"link\":\"/flash-report/architecture\"},{\"text\":\"Automation\",\"link\":\"/flash-report/automation-system\"},{\"text\":\"Cache Implementation\",\"link\":\"/flash-report/cache-implementation\"},{\"text\":\"Integration Guide\",\"link\":\"/flash-report/integration-guide\"},{\"text\":\"Testing Guide\",\"link\":\"/flash-report/testing-guide\"}]}],\"/weekly-report/\":[{\"text\":\"Weekly Reports\",\"items\":[{\"text\":\"Overview\",\"link\":\"/weekly-report/\"},{\"text\":\"Implementation\",\"link\":\"/weekly-report/implementation\"},{\"text\":\"Date Handling\",\"link\":\"/weekly-report/date-handling\"},{\"text\":\"Data Flow\",\"link\":\"/weekly-report/data-flow\"},{\"text\":\"API Reference\",\"link\":\"/weekly-report/api-reference\"},{\"text\":\"Email Notifications\",\"link\":\"/weekly-report/email-notifications\"}]}],\"/ai-integration/\":[{\"text\":\"AI Integration\",\"items\":[{\"text\":\"Overview\",\"link\":\"/ai-integration/\"},{\"text\":\"Prompts System\",\"link\":\"/ai-integration/prompts-system\"}]}],\"/api/\":[{\"text\":\"API Reference\",\"items\":[{\"text\":\"Overview\",\"link\":\"/api/\"},{\"text\":\"Authentication\",\"link\":\"/api/authentication\"},{\"text\":\"Rate Limits\",\"link\":\"/api/rate-limits\"},{\"text\":\"Error Codes\",\"link\":\"/api/error-codes\"},{\"text\":\"Endpoints\",\"collapsed\":false,\"items\":[{\"text\":\"Incidents\",\"link\":\"/api/endpoints/incidents\"},{\"text\":\"Reports\",\"link\":\"/api/endpoints/reports\"},{\"text\":\"Hotspots\",\"link\":\"/api/endpoints/hotspots\"},{\"text\":\"Countries\",\"link\":\"/api/endpoints/countries\"},{\"text\":\"Ports\",\"link\":\"/api/endpoints/ports\"}]}]}]},\"footer\":{\"message\":\"Released under the Internal License.\",\"copyright\":\"Copyright © 2023-present Atlas Bear\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/atlas-bear/mara\"}],\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>